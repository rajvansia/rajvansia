<!DOCTYPE html>

<html lang="en-us">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta property="og:image" content="http://www.rajvansia.com/images/bp.PNG" />
<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
<link rel="stylesheet" href="/assets/normalize.css">
<link rel="stylesheet" href="/assets/core.css">
<link rel="stylesheet" href="/assets/buttons.css">
<link rel="stylesheet" href="/assets/icons.css">
<link rel="stylesheet" href="/assets/article.css">
<link rel="stylesheet" href="/assets/contact_form.css">
<link rel="stylesheet" href="/assets/syntax.css">
<link rel="stylesheet" href="/assets/google_map_container.css">
<link rel="stylesheet" href="/assets/cover.css">
<link rel="stylesheet" href="/assets/pagination.css">
<link rel="stylesheet" href="/assets/site_header.css">
<link rel="stylesheet" href="/assets/site_footer.css">
<link rel="stylesheet" href="/assets/responsive.css">
<link rel="stylesheet" href="/assets/app.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/gist-embed/2.4/gist-embed.min.js"></script>
<style type="text/css">
.blogpic{
		max-width:100%
	}
  .blogimg{
  		max-width:50%
  	}
.title {
  font-family: 'Montserrat', sans-serif;
  margin-top: 80px;
  margin-bottom: 30px;
  color: white;
}


svg {
  font: 1px sans-serif;
}

.line {
  fill: none;
  stroke: #23fbbd;
  stroke-width: 3.5px;
}

.lineT {
    fill: none;
    stroke: #7dc7f4;
    stroke-width: 1px;

}

article .container {
    max-width: 100%;
    margin: 44 auto;
}
.tolerance {
  fill: none;
  stroke: black;
  stroke-width: 1.5px;
}

.axis path,
.axis line {
  fill: none;
  stroke: #000;
  shape-rendering: crispEdges;
}


b, strong {
    font-weight: 700;
    color: #b3b3b3;
}

.twitchSearchApp {
  width: 500px
}


.list-group {
  margin-left: auto;
  margin-right: auto;
  width: 500px;
   background-color: #293543;
}

.list-group-item {
   background-color: #293543;
}
.streamerName {
  font-size: 2.2em;
  font-weight: bold;
}

.numOfViewers {
  padding-left: 10px;
  font-size: 2.2em;
 color: rgb(0, 255, 0);
}

.fa-user {
  color: red;
}

.streamTitle {
  margin-bottom: 0px;
}

.patientText {
 color: black;

}

.patientButton {
 margin-bottom: 10px;

}

.streamerLogo {
  width: 75px;
  height: 75px;
}


/*footer {
  background-color: #673AB7;
  height: 50px;
  color: white;
}

footer p {
  margin-top: 20px;
  padding-top: 15px;
}*/
</style>
<head>
<meta charset="utf-8">
<title>Real Time Medical Device Vital Signs Prediction Using Kafka and Spark (Part 1)</title>


<link rel="shortcut icon" href="/images/favicon.ico" type="image/x-icon">
<link rel="icon" href="/images/favicon.ico" type="image/x-icon">

  <meta name="title" content="Real Time Medical Device Vital Signs Prediction Using Kafka and Spark (Part 1)">

  <meta property="og:description" content="Kafka IoT Medical Devices Spark"/>
  <meta name="description" content="Realtime prediction simulated devices kafka healthcare"/>

  <meta property="og:site_name" content="Raj Vansia">
</head>

<body>


<header class="site-header">
   <nav>
      <a class="brand" href="https://rajvansia.com/index.html">
        <img src="/images/logo.png" alt="Inc">
      </a>
      <a href="https://rajvansia.com/index.html">Blog</a>
      <a href="https://rajvansia.com/about/">About</a>
    </nav>
</header>


<!-- <div class="article-cover" style="background-image:url(https://lh3.googleusercontent.com/ym99kcNrnmKiPhr0ZtunGy-jy3EsNMU523iLcCkJn6fHpYMryq2CKa3VqqghunkU5-9Wp8XjPGYeZMZKCr1w-yidRJQ24_bX-hqHfsdXfhMDEWeHfFJtJGi9zybtsAqb6eZVlJ0C1dDhfpuScQxUex3752XDCX7QIGlSZhBWo08bLTZcOxWftofJA0RaRroiNtoSJDPFRYhT0NUltr1MUGUH8eimaF628Az6XZUahsc3UYhNREAbw9ciKCeK9bgC9I_h03rW_sofacD9dZJpGma1wOnrEnEjibYTSGFeJI6ITzoRPP2ZHzrz4TpZMuYKTS8IbI8sadolGYe5XZinxEDfzDyS3u_d6xViL-iRsqbsoigrCB49huTmJ6XjSbYih4EdCjK_dERmCrreA_gcQZ05F9PZV9i16-SvkVeRcm8PYUaipZUlaZnlyaBkNfPrKl1CxO9PX-w9dy15xlfXbhTtEzizLxZ6U-SpZRQf6jv5p2imYTpdlUholNXwr0nbnji-lKHA50ef5r8iHOKd8tvruzwsgZnL15gdMLPn0PY39_AuB_K5nOft5StAro6LnC2c=w799-h599-no)"></div> -->


<!-- <div class='cover-caption'><a href='/about.html#pictures'>Swiss Alps Photo: Janki Vansia</a></div> -->


<article >

<div class="container">
  <header>
    <div class="meta">
      By <address><a rel="author" href="/medical-vital-signs-kafka-1.html" title="Raj Vansia" target="_blank">Raj Vansia</a></address> &mdash;
      <time pubdate datetime="2016-27-November" title="Aug 9, 2016">Nov 27, 2016</time> &mdash;

20 min read
    </div>
    <h1 style="color:black" class="title">Real Time Medical Device Vital Signs Prediction Using Kafka and Spark (Part 1)</h1>

  </header>

  <img  src="/images/KafkaVitals-3devices.gif" style= "margin-left: 0px;" >
  <section>

    <!-- <p>Keeping tabs on all your medical devices</a>.</p> -->
<br></br>
<p>
This is the first part of our near-real-time vital signs predicting & alerting application. We will be simulating streaming vital sign data from medical devices using Apache Kafka. The streaming data can then be used to develop a near-real-time alerting and prediction by applying machine learning algorithms from Spark's mlib package. This can help predict when an adverse event might occur for a patient. Real-time streaming data is essential the when monitoring patients that are in critical conditions. You can imagine that the sensors and physiological monitors help paint the picture of the current state of the patient. We can use machine learning to help with our clinical decision in real-time when it matters most to the patient’s health. You can find the code to this project here find the code here on <a style="color:blue" href="https://github.com/rajvansia/VitalSimulatorKafka" target="_blank">github</a></p>

<p>
  In this post, we will focus on building a Kafka producer to simulate vitals data from a patient. We will simulate real-time data from various medical devices during the case such as cardiac monitors, pulse oximeters, physiological monitors, and non-invasive blood pressure cuff. The simulated medical devices will publish data to a Kafka broker and can be consumed by our Spark application or Kafka consumer.  Later on, I want to use historical patient data and combine it with real-time data to improve the prediction of the system and make it more personalized for the patient. This might consider family history, genetic information, drug history, and past health events. This can take us one step closer to personalized medicine where decisions are made by taking into account the patient’s current and past state.
</p>
<h1>Introduction to Apache Kafka</h1>
<p>
Kafka is a distributed publish subscribe messaging system created by LinkedIn. It is scalable and it can handle high throughput messaging. We are talking > 1million messages/sec!   The basic principle of a pub/sub system is that you have producers that publishes data to centralized data brokers for a specific topic then consumer applications can read messages for the topics they are subscribed to. You can read more about the basics <a style="color:blue" href="http://kafka.apache.org/intro" target="_blank">here.</a>  </p>


  <p>
    Kafka can handle messages from different sources at an extremely fast rate, perfect for streaming vital signs data from medical devices. A central data broker allows various medical devices to publish data so a consuming application only needs to subscribe to the topics it is interested in. For example, an application can subscribe to a topic called “Cardiac Monitor” to get data from just the cardiac monitor or you can subscribe to a topic called “Vitals” to get data from 5 various monitors for a specific patient. Additionally, consuming applications don’t need to manage the connections for every producer because data is sent to the centralized data brokers. You can easily add and remove producers in your system. Kafka can persist data for a set period typical for 7 days. If consumers are consuming at different rates there won't be any data loss or missed messages. Each consumer is independent of each other and is responsible for keeping track of what position they are at in the data stream. Kafka makes this possible because the messages are appended to a commit log and are immutable. So, every message is stored and has a unique number which determines its order.
  </p>
  <img class="blogimg" src="/images/kafka-apis.png" style= "margin-left: 0px;" >
  <h1>Project Dependencies</h1>
  <p>Pom File</p>
<code data-gist-id="f6346b03a586df19b25d16cab93be32d"   data-gist-file="pom.xml" data-gist-line="12-36"></code><p>
  <p>
    We need to include a few dependences in our POM file. The Kafka library will give us access to the producer and consumer classes. Additionally we will use the shade plugin to create an uber jar so we can independently execute the jar file. The jackson-databind will be used to serialize and deserialize json messages.
  </p>
  <h1> Steps to Deploy Locally on Windows<h1>
    <h3>Start a Zookeeper Server<h3>
    <p>
      Start zookeepr server by typing zkserver in the command line. You can define the server parameters in the config file For this demo app run zookeeper locally on port 2181. The zookeeper server is used to manage the work for the Kafka brokers
    </p>

    <h3>Start a Kafka broker <h3>
    <p>
      Start zookeepr server by typing zkserver in the command line. For this demo app run zookeeper locally on port 2181. The zookeeper server  is used to manage the work for the Kafka brokers
    </p>
    <h3>Create a Kafka Topic<h3>
    <p>
       Create topic kafka-topics.bat --create --zookeeper localhost:2181 --replication-factor 1 --partitions 1 --topic vitals. This command defines the partitions and the connection to our Zookeeper server. In this case we will be running on port 9092. the partitions acts as parallelisms to increase operational efficiency. This allows for multiple threads to be created to handle a large amount of consuming applications to read from the topics.
    </p>
    <h3>Create a Kafka Consumer and Vital Signs Producer<h3>
    <p>
      Execute your jar and pass the parameters <consumer> <none>. You won't see any messages being consumed until you start your producer app.
    </p>
    <p>
To create the producer app execute the jar file by accessing the main VitalSimulator class and pass the parameters of the device type "producer device type". For example if we want to simulate a cardiac monitor we will pass producer CardiacMonitor. The producer will produce simulated data to the Kafka broker then the consumers can subscribe to that topic and retrieve those messages.     </p>
<!--<code data-gist-id="4ba1fc18b8880e0f0e3bdb2b86da6059"></code>-->
<img class="blogpic" src="/images/KafkaVitals-Consumer-Producer.gif" style= "margin-left: 0px;">

<h3>Create Multiple Vital Signs Producers<h3>
<p>
Now to see the power of Kafka we can spin up two more producers to simulate SpO2 and blood pressure. You will notice that these 3 simulated devices send data independently to the same topic, "vitals", to the data broker. Now if you look at your consumer app you can see how all the messages from the various devices are being consumed. This will allow us to analyze all of the patients vitals data generated from different sources. </p>
<div class="social">

<div class='twitter'>
  <a href="https://twitter.com/share" class="twitter-share-button"  data-text="REal time tracking system" data-related="Rajvansia">Tweet</a>
</div>



<div class='facebook'>
  <div class="fb-share-button" data-layout="button_count"></div>
</div>






<!--
<div class='reddit'>
  <a href="//www.reddit.com/submit" onclick="window.open('//www.reddit.com/submit?url=http://willkoehler.net/2014/12/22/alternate-route-options-for-the-olentangy-trail.html&title=Alternate+Route+Options+For+The+Olentangy+Trail'); return false"> <img src="//www.redditstatic.com/spreddit7.gif" alt="submit to reddit" border="0" /> </a>
</div> -->

</div>

  </section>

  <footer style="margin-bottom:100px">
    <!-- <address>
      <img src="/images/wk.jpg">
      <p>Written by <strong><a rel="author" href="https://twitter.com/wckoehler" title="" target="_blank">Will Koehler</a></strong><br>
        <span class="muted">Cycling advocate and web developer.</span>
      </p>
    </address>



    <section class="post_summary">
      <h3 class="title">Previous story: <a href="/2014/11/07/client-side-solution-for-downloading-highcharts-charts-as-images.html" rel="prefetch">Client-Side Solution For Downloading Highcharts Charts as Images</a></h3>
      <p>I wanted a straightforward, client-side solution for downloading the SVG charts generated by Highcharts as images. It can be done, but relies on a set of web technologies that are still evolving.</p>
      <hr>
    </section> -->


    <section>
      <div id="disqus_thread"></div>
<script>
/**
* RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
* LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
*/
/*
var disqus_config = function () {
this.page.url = PAGE_URL; // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
*/
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');

s.src = '//rajvansia.disqus.com/embed.js';

s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
    </section>

  </footer>
</div>
</article>


<footer class="site-footer">
<div class="container">
  &copy; 2015 Raj Vansia

  <nav>
    <a href="/">Blog</a> &middot;
    <a href="/about">About</a>
  </nav>



  <ul class="social-networks bounce">
    <!-- <li><a href="https://www.linkedin.com/in/rajvansia" class="icon-linkedin">LinkedIn</a></li>
    <li><a href="https://twitter.com/rajvansia" class="icon-twitter">Twitter</a></li>
    <li><a href="https://facebook.com/raj.vansia" class="icon-facebook">Facebook</a></li>
     -->
   <li><a href="https://www.linkedin.com/in/rajvansia" class="icon-linkedin">LinkedIn</a></li>
    <li><a href="https://github.com/rajvansia" class="icon-github">GitHub</a></li>
    <li><a href="https://facebook.com/raj.vansia" class="icon-facebook">Facebook</a></li>
    <!-- <li><a href="https://twitch.tv" class="icon-twitch">Twitch</a></li>
    <li><a href="https://github.com" class="icon-github">GitHub</a></li>
    <li><a href="https://pinterest.com" class="icon-pinterest">Pinterest</a></li>
    <li><a href="https://instagram.com" class="icon-instagram">Instagram</a></li>
    <li><a href="https://vimeo.com" class="icon-vimeo">Vimeo</a></li> -->
  </ul>
  <div>Based on Incorporated theme by <a href="https://sendtoinc.com">Inc</a></div>
</div>
</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/pubnub/3.7.7/pubnub.js"></script>
<script src="https://cdn.jsdelivr.net/xdate/0.8/xdate.min.js"></script>
<script src="https://d3js.org/d3.v3.min.js" charset="utf-8"></script>
<script type="text/javascript" src="https://cdn.rawgit.com/smart-on-fhir/client-js/v0.1.1/dist/fhir-client.js"></script>
<script  src="./js/bundle.js"></script>



</body>
</html>
